{% extends "layout.twig" %}

{% block body %}
{# Hero Section with Gradient #}
<div class="hero-section">
    <div class="hero-grid">
        {# Left Side - Content #}
        <div class="hero-content">
            <div class="logo mb-4" style="font-size: 20px;">1 Trillion Smiles</div>

            <h1>Make work<br>a little happier</h1>

            <p>Bring a smile to coworker's face by sending kind messages - it'll make their day and make you a little happier, too.</p>

            <div class="hero-stats">
                <div class="hero-stat-item">
                    <div class="hero-stat-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                        </svg>
                    </div>
                    <span><strong>{{ global_smiles|number_format }}</strong> of 1T smiles spread worldwide</span>
                </div>
                <div class="hero-stat-item">
                    <div class="hero-stat-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
                        </svg>
                    </div>
                    <span><strong>{{ total_companies }}</strong> companies spreading smiles</span>
                </div>
                {% if featured_company %}
                <div class="hero-stat-item">
                    <div class="hero-stat-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/>
                        </svg>
                    </div>
                    <span><strong>{{ featured_company_smiles }}</strong> smiles spread at {{ featured_company_name }}</span>
                </div>
                {% endif %}
            </div>
        </div>

        {# Right Side - Signup Card #}
        <div class="signup-card">
            <h3>Get Started</h3>
            <form id="signup-form">
                <div class="form-group">
                    <label class="form-label">Your name</label>
                    <input type="text" name="name" class="form-input" placeholder="Alex" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Your email</label>
                    <input type="email" name="email" class="form-input" placeholder="alex@example.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Your avatar</label>
                    <div class="avatar-grid">
                        {% set avatars = ['ğŸŒŸ', 'ğŸŒˆ', 'â˜€ï¸', 'ğŸˆ', 'ğŸŒ¸', 'ğŸ¨', 'ğŸª', 'ğŸ­', 'ğŸ¦‹', 'ğŸŒº'] %}
                        {% for avatar in avatars %}
                            <button type="button" class="avatar-option" data-avatar="{{ avatar }}">{{ avatar }}</button>
                        {% endfor %}
                    </div>
                    <input type="hidden" name="avatar" id="avatar-input" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    Start Spreading Smiles
                </button>
            </form>
        </div>
    </div>
</div>

{# Examples Section #}
<div class="content-section" style="background: white; padding: 60px 0;">
    <div class="container">
        <h2 class="section-title" style="margin-bottom: 48px;">Here's what people are saying...</h2>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; max-width: 1000px; margin: 0 auto;">
            {# Example 1 #}
            <div style="background: var(--bg-light); border-radius: 12px; padding: 24px; border: 1px solid rgba(0,0,0,0.05);">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #FF6B6B, #FFE66D); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                        ğŸŒ¸
                    </div>
                    <div>
                        <div style="font-weight: 600; color: var(--text-dark);">Jessica Martinez</div>
                        <div style="font-size: 13px; color: var(--text-gray);">To Alex</div>
                    </div>
                </div>
                <div style="font-size: 32px; margin-bottom: 12px; text-align: center;">ğŸ™</div>
                <p style="color: var(--text-dark); font-style: italic; line-height: 1.6;">
                    "Thank you for covering for me in that meeting, I would have been fired without you."
                </p>
            </div>

            {# Example 2 #}
            <div style="background: var(--bg-light); border-radius: 12px; padding: 24px; border: 1px solid rgba(0,0,0,0.05);">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #4ECDC4, #44A08D); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                        ğŸ¨
                    </div>
                    <div>
                        <div style="font-weight: 600; color: var(--text-dark);">Priya Patel</div>
                        <div style="font-size: 13px; color: var(--text-gray);">To Jordan</div>
                    </div>
                </div>
                <div style="font-size: 32px; margin-bottom: 12px; text-align: center;">âš¡</div>
                <p style="color: var(--text-dark); font-style: italic; line-height: 1.6;">
                    "You are one of my favorite people to brainstorm with - you always have good energy and ideas."
                </p>
            </div>
        </div>
    </div>
</div>

{# Mission Section #}
<div class="content-section">
    <div class="container">
        <h2 class="section-title mb-3">Mission: Create 1 trillion smiles at work, one at a time.</h2>
        <p class="section-subtitle">Send smiles to people you care about, and join the movement to make the workplace a little brighter.</p>

        <div class="stats-grid">
            {# Total Smiles Card #}
            <div class="stat-card">
                <div class="stat-card-header">
                    <div class="stat-card-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                        </svg>
                    </div>
                    <div>
                        <div class="stat-card-title">Total Smiles</div>
                        <div class="stat-card-subtitle">created globally</div>
                    </div>
                </div>
                <div class="stat-card-number">{{ global_smiles|number_format }}</div>
                <div class="stat-card-label">{{ global_progress }}% of 1 trillion</div>
                <div class="stat-card-progress">
                    <div class="stat-card-progress-bar" style="width: {{ global_progress }}%;"></div>
                </div>
            </div>

            {# Companies Card #}
            <div class="stat-card">
                <div class="stat-card-header">
                    <div class="stat-card-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
                        </svg>
                    </div>
                    <div>
                        <div class="stat-card-title">{{ total_companies }} companies</div>
                        <div class="stat-card-subtitle">spreading smiles</div>
                    </div>
                </div>

                {% for company in top_companies %}
                    <div class="leaderboard-item">
                        <div class="leaderboard-rank">#{{ loop.index }}</div>
                        <div class="leaderboard-avatar">ğŸ¢</div>
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">{{ company.company }}</div>
                            <div class="leaderboard-count">{{ company.smile_count }} smiles created</div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            {# Top Senders Card #}
            {% if featured_company %}
            <div class="stat-card">
                <div class="stat-card-header">
                    <div class="stat-card-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
                            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/>
                        </svg>
                    </div>
                    <div>
                        <div class="stat-card-title">{{ featured_company_smiles }} {{ featured_company_name }} smiles</div>
                        <div class="stat-card-subtitle">from {{ featured_company_name }} employees</div>
                    </div>
                </div>

                {% for sender in featured_company_top_senders|slice(0, 3) %}
                <div class="leaderboard-item">
                    <div class="leaderboard-rank">#{{ loop.index }}</div>
                    <div class="leaderboard-avatar">{{ sender.avatar }}</div>
                    <div class="leaderboard-info">
                        <div class="leaderboard-name">{{ sender.name }}</div>
                        <div class="leaderboard-count">{{ sender.smile_count }} smiles created</div>
                    </div>
                </div>
                {% else %}
                <div style="padding: 40px 20px; text-align: center; color: var(--text-gray);">
                    No smile creators yet from {{ featured_company_name }}
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
</div>

{# Global Smiles Modal #}
<div id="global-modal" class="modal-overlay hidden">
    <div class="modal">
        <button class="modal-close" onclick="hideModal('global-modal')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
        </button>
        <div class="modal-header">
            <div class="modal-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                </svg>
            </div>
            <div>
                <h2 class="modal-title">Global Smiles</h2>
                <p class="modal-subtitle">Progress toward 1 trillion</p>
            </div>
        </div>
        <div style="margin-bottom: 24px;">
            <div style="font-size: 48px; font-weight: 700; color: var(--orange); margin-bottom: 8px;">{{ global_smiles|number_format }}</div>
            <div style="font-size: 16px; color: var(--text-gray); margin-bottom: 16px;">{{ global_progress }}% of 1 trillion smiles</div>
            <div class="stat-card-progress" style="height: 12px;">
                <div class="stat-card-progress-bar" style="width: {{ global_progress }}%;"></div>
            </div>
        </div>
        <p style="color: var(--text-gray); font-size: 14px; line-height: 1.6;">Every smile counts toward our mission to create 1 trillion smiles worldwide. Keep spreading happiness!</p>
    </div>
</div>

{# Between-Company Modal #}
<div id="company-modal" class="modal-overlay hidden">
    <div class="modal">
        <button class="modal-close" onclick="hideModal('company-modal')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
        </button>
        <div class="modal-header">
            <div class="modal-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
                </svg>
            </div>
            <div>
                <h2 class="modal-title">Company Leaderboard</h2>
                <p class="modal-subtitle">{{ total_companies }} companies spreading smiles</p>
            </div>
        </div>
        <div style="max-height: 400px; overflow-y: auto;">
            {% for company in top_companies %}
                <div class="leaderboard-item">
                    <div class="leaderboard-rank">#{{ loop.index }}</div>
                    <div class="leaderboard-avatar">ğŸ¢</div>
                    <div class="leaderboard-info">
                        <div class="leaderboard-name">{{ company.company }}</div>
                        <div class="leaderboard-count">{{ company.smile_count }} smiles created</div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>

{# Within-Company Modal #}
<div id="within-company-modal" class="modal-overlay hidden">
    <div class="modal">
        <button class="modal-close" onclick="hideModal('within-company-modal')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
        </button>
        <div class="modal-header">
            <div class="modal-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/>
                </svg>
            </div>
            <div>
                <h2 class="modal-title" id="within-company-title">Company Leaderboard</h2>
                <p class="modal-subtitle" id="within-company-subtitle">Top smile creators</p>
            </div>
        </div>
        <div id="within-company-content" style="max-height: 400px; overflow-y: auto;">
            {# Content loaded dynamically #}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Modal functions
function showModal(modalId) {
    document.getElementById(modalId).classList.remove('hidden');
}

function hideModal(modalId) {
    document.getElementById(modalId).classList.add('hidden');
}

// Load within-company modal data
async function showWithinCompanyModal(company) {
    try {
        const response = await fetch(`/api/company-stats/${company}`);
        const data = await response.json();

        const companyName = company.charAt(0).toUpperCase() + company.slice(0, company.indexOf('.')).slice(1);
        document.getElementById('within-company-title').textContent = `${companyName} Leaderboard`;
        document.getElementById('within-company-subtitle').textContent = `${data.smile_count} smiles created`;

        const content = data.top_senders.map((sender, index) => `
            <div class="leaderboard-item">
                <div class="leaderboard-rank">#${index + 1}</div>
                <div class="leaderboard-avatar">${sender.avatar}</div>
                <div class="leaderboard-info">
                    <div class="leaderboard-name">${sender.name}</div>
                    <div class="leaderboard-count">${sender.smile_count} smiles created</div>
                </div>
            </div>
        `).join('');

        document.getElementById('within-company-content').innerHTML = content || '<div style="padding: 40px; text-align: center; color: var(--text-gray);">No smile creators yet</div>';
        showModal('within-company-modal');
    } catch (error) {
        console.error('Error loading company stats:', error);
    }
}

// Make stat cards clickable on homepage
document.addEventListener('DOMContentLoaded', function() {
    // Select only stat cards within the stats-grid section
    const statCards = document.querySelectorAll('.stats-grid .stat-card');
    console.log('Found stat cards in stats-grid:', statCards.length);

    if (statCards[0]) {
        statCards[0].style.cursor = 'pointer';
        statCards[0].addEventListener('click', function() {
            showModal('global-modal');
        });
    }
    if (statCards[1]) {
        statCards[1].style.cursor = 'pointer';
        statCards[1].addEventListener('click', function() {
            showModal('company-modal');
        });
    }
    {% if featured_company %}
    if (statCards[2]) {
        statCards[2].style.cursor = 'pointer';
        statCards[2].addEventListener('click', function() {
            showWithinCompanyModal('{{ featured_company }}');
        });
    }
    {% endif %}
});

// Avatar picker
document.querySelectorAll('.avatar-option').forEach(btn => {
    btn.addEventListener('click', function(e) {
        e.preventDefault();
        document.querySelectorAll('.avatar-option').forEach(b => b.classList.remove('selected'));
        this.classList.add('selected');
        document.getElementById('avatar-input').value = this.dataset.avatar;
    });
});

// Signup form
document.getElementById('signup-form').addEventListener('submit', async function(e) {
    e.preventDefault();

    const formData = new FormData(this);
    const data = {
        name: formData.get('name'),
        email: formData.get('email'),
        avatar: formData.get('avatar')
    };

    if (!data.avatar) {
        alert('Please pick your vibe');
        return;
    }

    try {
        const response = await fetch('/api/signup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.success) {
            if (result.existing) {
                // Email already exists - show message
                alert(result.message);
            } else {
                // New user - redirect to dashboard
                window.location.href = `/dashboard/${result.dashboard_url}?first_visit=1`;
            }
        } else {
            alert(result.error || 'Signup failed. Please try again.');
        }
    } catch (error) {
        console.error('Signup error:', error);
        alert('An error occurred. Please try again.');
    }
});
</script>
{% endblock %}
